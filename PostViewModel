 package mx.edu.utng.ejgj.basededatos2.ui.theme.viewmodel

 import android.app.Application
 import androidx.compose.runtime.mutableStateOf
 import androidx.lifecycle.AndroidViewModel
 import androidx.room.Room
 import androidx.compose.runtime.State
 import androidx.lifecycle.viewModelScope
 import kotlinx.coroutines.launch
 import mx.edu.utng.ejgj.basededatos2.data.entity.PostEntity
 import mx.edu.utng.ejgj.basededatos2.data.local.database.AppDataBase

 class PostViewModel(application: Application): AndroidViewModel(application) {
     private val dao = Room.databaseBuilder(application,
         AppDataBase::class.java,"diario_db"
     ).build().postDao()

     private val _posts = mutableStateOf<List
     <PostEntity>>(emptyList())

     val posts: State<List<PostEntity>> = _posts

     init {
         //Cargar datos de las publicaciones
         loadPosts()
     }

     fun loadPosts() {
         viewModelScope.launch {
             _posts.value = dao.getAll()
         }
     }

     //Funci贸n que agrega una nueva publicaci贸n
     fun addPost(content: String) {
         viewModelScope.launch {
             //Insertar el contenido
             dao.insert(PostEntity(content = content))
             //Actualizar la lista
             loadPosts()
         }
     }

     //Funci贸n que elimina una publicaci贸n
     fun deletePost(post: PostEntity) {
         viewModelScope.launch {
             dao.delete(post)
             loadPosts()
         }
     }
 }
